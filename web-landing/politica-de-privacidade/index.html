<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      http-equiv="Cache-Control"
      content="no-store, no-cache, must-revalidate, max-age=0"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Política de Privacidade — Saravafy</title>

    <link rel="icon" href="/images/favicon-light-mode.png" type="image/png" />
    <link
      rel="icon"
      href="/images/favicon-light-mode.png"
      type="image/png"
      media="(prefers-color-scheme: light)"
    />
    <link
      rel="icon"
      href="/images/favicon-dark-mode.png"
      type="image/png"
      media="(prefers-color-scheme: dark)"
    />

    <link rel="stylesheet" href="/styles.css?v=2026-01-07-1" />
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@19.1.0",
          "react/jsx-runtime": "https://esm.sh/react@19.1.0/jsx-runtime",
          "react/jsx-dev-runtime": "https://esm.sh/react@19.1.0/jsx-dev-runtime",
          "react-dom/client": "https://esm.sh/react-dom@19.1.0/client",
          "react-markdown": "https://esm.sh/react-markdown@10.1.0",
          "remark-gfm": "https://esm.sh/remark-gfm@4.0.1"
        }
      }
    </script>
  </head>
  <body>
    <main class="policy-page">
      <div class="policy-container">
        <header class="policy-header">
          <h1 class="policy-title">Política de Privacidade — Saravafy</h1>
          <p id="lastUpdated" class="policy-updated" style="display: none"></p>
        </header>

        <div
          id="root"
          class="policy-markdown markdown"
          aria-label="Conteúdo da política"
        ></div>
      </div>
    </main>

    <script type="module">
      import React, { useEffect, useMemo, useState } from "react";
      import { createRoot } from "react-dom/client";
      import ReactMarkdown from "react-markdown";
      import remarkGfm from "remark-gfm";

      function extractLastUpdated(markdown) {
        const lines = String(markdown || "").split(/\r?\n/);
        const line = lines.find((l) =>
          /\b(Última atualização|Ultima atualizacao)\b\s*:/i.test(l)
        );
        return line ? line.trim() : null;
      }

      function stripLeadingTitle(markdown) {
        // Remove apenas o primeiro heading H1 (o título), mantendo o restante intacto.
        return String(markdown || "").replace(/^#\s+.*(?:\r?\n){1,2}/, "");
      }

      function PrivacyPolicyApp() {
        const [md, setMd] = useState("");

        useEffect(() => {
          let cancelled = false;
          fetch("/politica-de-privacidade.md", { cache: "no-store" })
            .then((r) => r.text())
            .then((text) => {
              const t = String(text || "");
              const looksLikeHtml = /^\s*<!doctype\s+html|^\s*<html\b/i.test(t);
              if (looksLikeHtml) {
                throw new Error("Markdown não foi servido (recebi HTML).");
              }
              if (!cancelled) setMd(text);
            })
            .catch(() => {
              if (!cancelled)
                setMd(
                  "\n\nFalha ao carregar o conteúdo.\n\nTente abrir: /politica-de-privacidade.md\n"
                );
            });
          return () => {
            cancelled = true;
          };
        }, []);

        const lastUpdated = useMemo(() => extractLastUpdated(md), [md]);
        const bodyMd = useMemo(() => stripLeadingTitle(md), [md]);

        useEffect(() => {
          const el = document.getElementById("lastUpdated");
          if (!el) return;
          if (!lastUpdated) {
            el.style.display = "none";
            el.textContent = "";
            return;
          }
          el.style.display = "block";
          el.textContent = lastUpdated;
        }, [lastUpdated]);

        return React.createElement(ReactMarkdown, {
          remarkPlugins: [remarkGfm],
          skipHtml: true,
          components: {
            a: ({ href, children, ...props }) =>
              React.createElement(
                "a",
                {
                  ...props,
                  href,
                  target: "_blank",
                  rel: "noreferrer noopener",
                },
                children
              ),
            h1: ({ children, ...props }) =>
              React.createElement(
                "h2",
                { ...props, className: "md-h1" },
                children
              ),
            h2: ({ children, ...props }) =>
              React.createElement(
                "h3",
                { ...props, className: "md-h2" },
                children
              ),
            h3: ({ children, ...props }) =>
              React.createElement(
                "h4",
                { ...props, className: "md-h3" },
                children
              ),
          },
          children: bodyMd,
        });
      }

      const rootEl = document.getElementById("root");
      if (rootEl) {
        createRoot(rootEl).render(React.createElement(PrivacyPolicyApp));
      }
    </script>
  </body>
</html>
